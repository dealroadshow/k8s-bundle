
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/finsight-logo-black.svg">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.3.9">
    
    
      
        <title>Application lifecycle - Dealroadshow K8S Framework</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/styles/atom-one-light.min.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#k8s-framework-application-lifecycle" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Dealroadshow K8S Framework" class="md-header__button md-logo" aria-label="Dealroadshow K8S Framework" data-md-component="logo">
      
  <img src="../assets/finsight-logo-white.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Dealroadshow K8S Framework
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Application lifecycle
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Dealroadshow K8S Framework" class="md-nav__button md-logo" aria-label="Dealroadshow K8S Framework" data-md-component="logo">
      
  <img src="../assets/finsight-logo-white.svg" alt="logo">

    </a>
    Dealroadshow K8S Framework
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../how-to-read/" class="md-nav__link">
        How to read this docs
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../vision/" class="md-nav__link">
        Our vision
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/" class="md-nav__link">
        Getting started
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Basic concepts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Basic concepts" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Basic concepts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/manifests/" class="md-nav__link">
        Manifests
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/containers/" class="md-nav__link">
        Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/apps/" class="md-nav__link">
        Apps
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Application lifecycle
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Application lifecycle
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#console-commands" class="md-nav__link">
    Console commands
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#application-lifecycle" class="md-nav__link">
    Application lifecycle
  </a>
  
    <nav class="md-nav" aria-label="Application lifecycle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#collecting-app-instances" class="md-nav__link">
    Collecting app instances
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#collecting-manifest-instances" class="md-nav__link">
    Collecting manifest instances
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processing-apps" class="md-nav__link">
    Processing apps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dumping-manifests" class="md-nav__link">
    Dumping manifests
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../methods-interception/" class="md-nav__link">
        Manifest methods interception
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../env-management/" class="md-nav__link">
        Environments management
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../reusable-apps/" class="md-nav__link">
        Distribute your apps
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#console-commands" class="md-nav__link">
    Console commands
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#application-lifecycle" class="md-nav__link">
    Application lifecycle
  </a>
  
    <nav class="md-nav" aria-label="Application lifecycle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#collecting-app-instances" class="md-nav__link">
    Collecting app instances
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#collecting-manifest-instances" class="md-nav__link">
    Collecting manifest instances
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processing-apps" class="md-nav__link">
    Processing apps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dumping-manifests" class="md-nav__link">
    Dumping manifests
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="k8s-framework-application-lifecycle">K8S Framework application lifecycle</h1>
<h2 id="prerequisites">Prerequisites</h2>
<p>This article assumes that you are:</p>
<ul>
<li>familiar with Kubernetes itself</li>
<li>have read about <a href="../concepts/manifests/">manifests</a></li>
<li>have basic understanding of <a href="../concepts/apps/">apps</a> concept</li>
</ul>
<h2 id="console-commands">Console commands</h2>
<p><a href="https://github.com/dealroadshow/k8s-bundle">K8S Bundle</a> defines <strong>4</strong> console commands for manifest generation, which can be used with <a href="https://symfony.com/doc/current/console.html#running-commands">Symfony Console entry-point</a> <strong><code>bin/console</code></strong>:</p>
<ul>
<li><code>k8s:dump:all</code> - dump all manifests as YAML files to configured location (by default - <code>src/App/Resources/k8s-manifests</code> dir)</li>
<li><code>k8s:dump:apps</code> - dump manifests from chosen apps</li>
<li><code>k8s:print:all</code> - print all manifests to stdout in YAML format</li>
<li><code>k8s:print:apps</code> - print manifests from chosen apps to stdout in YAML format</li>
</ul>
<p>Despite small differences in this commands, app's lifecycle is the same for any of them.</p>
<h2 id="application-lifecycle">Application lifecycle</h2>
<p>"<em>Application</em>" here refers to the Symfony application that generates manifests when you call one of the console commands listed above, not <a href="../concepts/apps/"><em>App</em></a> in K8S Framework. So what happens when applicaton starts?</p>
<h3 id="collecting-app-instances">Collecting app instances</h3>
<p>Class <strong><code>AppRegistry</code></strong> has a simple API that allows to register / store <a href="../concepts/apps/">app</a> instances and retrieve them. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Thanks to awesome <a href="https://symfony.com/doc/current/service_container.html">Dependency Injection</a> in Symfony (including <a href="https://symfony.com/doc/current/service_container/autowiring.html">autowiring</a> and <a href="https://symfony.com/doc/current/service_container.html#the-autoconfigure-option">autoconfiguration</a>) you just need to define an App class, and it's instance will be created and registered in Symfony's Dependency Injection container.</p>
</div>
<p>When Symfony application starts, K8S framework retrieves all app instances from Symfony DI-container and registers them in <strong><code>AppRegistry</code></strong>. </p>
<div class="admonition note">
<p class="admonition-title">Good to know</p>
<p>This job is done by <code>AppsPass</code> class in K8S Bundle. <code>AppsPass</code> is an example of an important concept in Symfony - <a href="https://symfony.com/doc/current/service_container/compiler_passes.html#working-with-compiler-passes-in-bundles">Compiler Pass</a>. If you want to dive deeply into how K8S Framework works - you may want to know this concept.</p>
</div>
<p>After all apps are collected to <code>AppRegistry</code> - it's time to collect manifests and register them in <code>ManifestRegistry</code>.</p>
<h3 id="collecting-manifest-instances">Collecting manifest instances</h3>
<p>Just like <code>AppRegistry</code> stores app instances, <strong><code>ManifestRegistry</code></strong> class stores and allows to retrieve instances of manifests. Manifests are stored with the information about app they <em>belong to</em>. How does K8S Framework decides, which app <em>owns</em> manifest? By default this is done by checking if manifest class resides in <em>app namespace</em>. Every app is generated in dedicated directory. For example, if we have app class <code>K8S\Hello\HelloApp</code> - app namespace is <code>K8S\Hello\</code> and any namespace below. So if we have manifest class <code>K8S\Hello\Manifest\WorldDeployment</code> - K8S framework sees that this deployment's namespase is under <code>HelloApp</code>'s namespace <code>K8S\Hello\</code> and thus registers <code>WorldDeloyment</code> instance in <code>ManifestRegistry</code> as manifest that belongs to <code>HelloApp</code>.</p>
<div class="admonition note">
<p class="admonition-title">Good to know</p>
<p>Just like <code>AppsPass</code> registers apps in <code>AppRegistry</code>, the job of collecting manifest instances and adding them to <code>ManifestRegistry</code> is done by another compiler pass - <code>ManifestsPass</code>.</p>
</div>
<h3 id="processing-apps">Processing apps</h3>
<p>Now that all apps and manifests are registered in corresponding registries, K8S framework can start to <em>process</em> apps. It iterates over chosen app names, retrieves app instances from <code>AppRegistry</code> and for each app retrieves all instances of manifests that belong to this app. It then iterates over manifests and processes them - native Kubernetes API objects are created and filled with data by calling methods from your manifest instances. The result of processing each manifest is an API object or that implements <code>APIResourceInterface</code> and can be directly encoded into a valid JSON, understandable by your Kubernetes cluster. This API resource object is added to the app instance by calling it's method <code>addManifestFile()</code> (this method is a part of <code>AppInterface</code>). App is <em>processed</em> when it's manifest are processed and corresponding API objects are added to app.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You may have noticed that we are calling result of manifest processing "API object" or "API resource", but method in <code>AppInterface</code> is called <code>addManifestFile()</code>. "Manifest file" is a combination of API object and filename it will be dumped with.</p>
</div>
<h3 id="dumping-manifests">Dumping manifests</h3>
<p>When all apps are <em>processed</em> - framework iterates once again over all app instances. This time for each app it retrieves all API resources, added during previous stage, encodes them to YAML format and saves them to filesystem or prints them to stdout, depending on what console command is called. After all manifests are dumped - application made it's job, so it finishes.</p>
<h2 id="summary">Summary</h2>
<p>In this article we learned about lifecycle of manifests generation. If you got to this page by clicking link in <a href="../concepts/apps/">Apps</a> article - feel free to return to it.</p>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../concepts/apps/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Apps" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Apps
            </div>
          </div>
        </a>
      
      
        
        <a href="../methods-interception/" class="md-footer__link md-footer__link--next" aria-label="Next: Manifest methods interception" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Manifest methods interception
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.6c7ad80a.min.js"></script>
      
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/highlight.min.js"></script>
      
        <script src="../assets/init.js"></script>
      
    
  </body>
</html>
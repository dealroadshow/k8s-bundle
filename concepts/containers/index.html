
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/finsight-logo-black.svg">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.3.9">
    
    
      
        <title>Containers - Dealroadshow K8S Framework</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/styles/atom-one-light.min.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#containers" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Dealroadshow K8S Framework" class="md-header__button md-logo" aria-label="Dealroadshow K8S Framework" data-md-component="logo">
      
  <img src="../../assets/finsight-logo-white.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Dealroadshow K8S Framework
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Containers
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Dealroadshow K8S Framework" class="md-nav__button md-logo" aria-label="Dealroadshow K8S Framework" data-md-component="logo">
      
  <img src="../../assets/finsight-logo-white.svg" alt="logo">

    </a>
    Dealroadshow K8S Framework
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../how-to-read/" class="md-nav__link">
        How to read this docs
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../vision/" class="md-nav__link">
        Our vision
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/" class="md-nav__link">
        Getting started
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Basic concepts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Basic concepts" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Basic concepts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../manifests/" class="md-nav__link">
        Manifests
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Containers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Containers
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#container-images" class="md-nav__link">
    Container images
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-environment-variables-for-container" class="md-nav__link">
    Defining environment variables for container
  </a>
  
    <nav class="md-nav" aria-label="Defining environment variables for container">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simple-env-variable" class="md-nav__link">
    Simple env variable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#env-variable-from-configmap-or-secret" class="md-nav__link">
    Env variable from ConfigMap or Secret
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#env-variable-from-container-resources" class="md-nav__link">
    Env variable from container resources
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#env-variable-from-pod-fields" class="md-nav__link">
    Env variable from pod fields
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#import-all-keys-from-configmap-or-secret-as-env-variables" class="md-nav__link">
    Import all keys from ConfigMap or Secret as env variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-env-configmaps-or-secrets-that-are-in-different-app" class="md-nav__link">
    Using env ConfigMaps or Secrets that are in different app
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volumes-and-volumemounts" class="md-nav__link">
    Volumes and VolumeMounts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../apps/" class="md-nav__link">
        Apps
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../lifecycle/" class="md-nav__link">
        Application lifecycle
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../methods-interception/" class="md-nav__link">
        Manifest methods interception
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../env-management/" class="md-nav__link">
        Environments management
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../reusable-apps/" class="md-nav__link">
        Distribute your apps
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#container-images" class="md-nav__link">
    Container images
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-environment-variables-for-container" class="md-nav__link">
    Defining environment variables for container
  </a>
  
    <nav class="md-nav" aria-label="Defining environment variables for container">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simple-env-variable" class="md-nav__link">
    Simple env variable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#env-variable-from-configmap-or-secret" class="md-nav__link">
    Env variable from ConfigMap or Secret
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#env-variable-from-container-resources" class="md-nav__link">
    Env variable from container resources
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#env-variable-from-pod-fields" class="md-nav__link">
    Env variable from pod fields
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#import-all-keys-from-configmap-or-secret-as-env-variables" class="md-nav__link">
    Import all keys from ConfigMap or Secret as env variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-env-configmaps-or-secrets-that-are-in-different-app" class="md-nav__link">
    Using env ConfigMaps or Secrets that are in different app
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volumes-and-volumemounts" class="md-nav__link">
    Volumes and VolumeMounts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="containers">Containers</h1>
<p>Containers are the heart of any <a href="https://kubernetes.io/docs/concepts/workloads/">workload</a>. No matter what workload type are you dealing with (<a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployment</a>, <a href="https://kubernetes.io/docs/concepts/workloads/controllers/job/">Job</a>, <a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/">StatefulSet</a> etc.), you'll have to define containers for it - but the good news is that container API object is the same for any workload, so you'll need to learn it once and use in any manifest.</p>
<p>All containers in K8S Framework must implement <code>ContainerInterface</code>. Containers returned from method <code>containers()</code> in workload. You may return array of them, or (which looks better) use <code>yield</code> keyword, for examle:</p>
<pre class="php"><code>public function containers(): iterable
{
    yield new PhpFpmContainer();
    yield new NginxContainer();
}
</code></pre>
<p>Also every workload type has <code>Container</code>-prefixed abstract class, which is a recommended way of writing your manifest: for example, there is <code>AbstractDeplyment</code> class that you may inherit, but there is also <code>Container</code>-prefixed class <code>AbstractContainerDeployment</code>, which implements both <code>DeploymentInterface</code> and <code>ContainerInterface</code> - by inheriting this class, you'll make your manifest much more descriptive - define your "main" container methods in deployment class itself, and if you also need some auxiliary containers - rewrite <code>containers()</code> method amd return them as well.</p>
<p>For example, if your deployment <code>ExampleDeployment</code> has <code>php-fpm</code> and <code>nginx</code> containers - just extend <code>AbstractContainerDeployment</code> class, define <code>php-fpm</code> container method in <code>ExampleDeployment</code> itself (since <code>php-fpm</code> holds your application code and may be considered as "main" container), and that rewrite your <code>containers()</code> method as follows:</p>
<pre class="php"><code>class ExampleDeployment extends AbstractContainerDeployment
{
    public function containers(): iterable
    {
        yield $this;
        yield new NginxContainer();
    }

    //...
}
</code></pre>
<p>Separate container classes, like <code>NginxContainer</code> from example above, should be defined in <code>Container</code> namespace inside your app. </p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>App's directory structure is explained in <a href="../apps/">Apps</a> article.</p>
</div>
<p>Since every container class must implement <code>ContainerInterface</code>, there is an abstract class <code>AbstractContainer</code> for you, which helps you with that by defining most of the methods from <code>ContainerInterface</code> with reasonable defaults. You then just have to modify what should be modified:</p>
<pre class="php"><code>namespace App\K8S\Hello\Container;

use Dealroadshow\K8S\Framework\Core\Container\AbstractContainer;
use Dealroadshow\K8S\Framework\Core\Container\Image\Image;

class NginxContainer extends AbstractContainer
{
    public function image(): Image
    {
        return Image::fromName('nginx');
    }
}
</code></pre>
<p>This is a perfectly valid container class. <code>AbstractContainer</code> requires from you to define only <code>image()</code> method. </p>
<h2 id="container-images">Container images</h2>
<p>All containers are created from images, so every container needs one. Defining image your container will use is as simple as defining <code>image()</code> method in your manifest, as shown in the example above. As you see, this method must return instance of <code>Image</code> class. <code>Image</code> is a pretty easey to use value-object. Basically, you can just use one of the static constructors: <code>Image::fromName()</code> or <code>Image::fromString()</code>. The difference between two is that <code>Image::fromString</code> expects full image information as parameter - along with repository url, image tag and so on. For example, if you image is stored in <a href="https://aws.amazon.com/ecr/">AWS ECR</a> and you want to deploy tag <code>1.2.3</code> of your <code>my-organization/cool-application</code> image, your method <code>image()</code> may look as follows:</p>
<pre class="php"><code>public function image(): Image
{
    return Image::fromString(
        '49367101234912.dkr.ecr.us-east-1.amazonaws.com/my-organization/cool-application:1.2.3'
    );
}
</code></pre>
<p>If you prefer using <code>Image::fromName()</code> constructor, this is how method <code>image()</code> would like if you want to return the same image as above:</p>
<pre class="php"><code>public function image(): Image
{
    return Image::fromName('cool-application')
        -&gt;setPrefix('my-organization')
        -&gt;setTag('1.2.3')
        -&gt;setRegistryUrl('49367101234912.dkr.ecr.us-east-1.amazonaws.com');
}</code></pre>
<p>But the one thing that may come to your mind, is "It's not cool to modify <code>image()</code> method to change tag every time I need to deploy new version of my application". And you are absolutely right. This problem above is pretty easy to solve by using environment variable in code and passing this variable from whatever CI/CD tool you use. You may write <code>setTag(getenv('MY_APPLICATION_TAG'))</code> instead of <code>setTag(1.2.3)</code> in your code. But even after that - if you use Kubernetes, there are probably plenty of different images built in your organization, so you'll need to repeat <code>setRegistryUrl()</code> and <code>setPrefix()</code> parts many times. There is a solution in K8S Framework, specifically created to address issues like that. If you want to want to avoid such repetitiveness in your code - please read <a href="../images-middleware/">Images Middleware</a>.</p>
<h2 id="defining-environment-variables-for-container">Defining environment variables for container</h2>
<p>Passing environment variables to your containers are one of the most often used features in Kubernetes manifests. All environment variables for your container are defined in <code>env()</code> method. Just after your IDE have generated this method for you, it should look like follows:</p>
<pre class="php"><code>public function env(EnvConfigurator $env): void
{
}
</code></pre>
<p>To define single env variable - use <code>$env-&gt;var()</code> method:</p>
<h3 id="simple-env-variable">Simple env variable</h3>
<pre class="php"><code>public function env(EnvConfigurator $env): void
{
    $env
        -&gt;var('VARIABLE_NAME', 'SOME VALUE')
        -&gt;var('FOO', 'Bar!');
}
</code></pre>
<p>In Kubernetes manifests you can also define env variable that gets it's value from a plenty of different sources:</p>
<h3 id="env-variable-from-configmap-or-secret">Env variable from ConfigMap or Secret</h3>
<p>Env variable may get it's value from some key in <a href="https://kubernetes.io/docs/concepts/configuration/configmap/">ConfigMap</a> or <a href="https://kubernetes.io/docs/concepts/configuration/secret/">Secret</a>. K8S Framework follows simple rule: <strong>You don't deal with manifest names in manifest classes</strong>, since simple typo in name of resource you want to use will lead to errors that's not immediately detectable. Instead, framework makes it easy to deal with connections between different Kubernetes resources by using their class names:</p>
<pre class="php"><code>public function env(EnvConfigurator $env): void
{
    $env
        -&gt;varFromConfigMap(
            varName: 'MY_VAR',
            configMapClass: SomeConfigMap::class,
            configMapKey: 'someKey'
        )
        -&gt;varFromSecret(
            varName: 'MY_VAR',
            secretClass: SomeSecret::class,
            secretKey: 'someKey'
        )
    ;
}
</code></pre>
<h3 id="env-variable-from-container-resources">Env variable from container resources</h3>
<p>Kubernetes allows you to pass your resources requests and limits as values of env variables:</p>
<pre class="php"><code>public function env(EnvConfigurator $env): void
{
    $env
        -&gt;varFromContainerResources(
            varName: 'MY_CPU_LIMITS',
            field: ContainerResourcesField::cpuLimits()
        )
        -&gt;varFromContainerResources(
            varName: 'MY_MEMORY_REQUESTS',
            field: ContainerResourcesField::memoryRequests()
        )
    ;
}</code></pre>
<h3 id="env-variable-from-pod-fields">Env variable from pod fields</h3>
<p>Kubernetes also allows to pass some info about pod:</p>
<pre class="php"><code>public function env(EnvConfigurator $env): void
{
    $env
        -&gt;varFromPod(
            varName: 'MY_IP',
            podField: PodField::podIp()
        )
        -&gt;varFromPod(
            varName: 'MY_METADATA_LABELS',
            podField: PodField::metadataLabels()
        )
    ;
}
</code></pre>
<h3 id="import-all-keys-from-configmap-or-secret-as-env-variables">Import all keys from ConfigMap or Secret as env variables</h3>
<p>Sometimes you'll want to import an entire <a href="https://kubernetes.io/docs/concepts/configuration/configmap/">ConfigMap</a> or <a href="https://kubernetes.io/docs/concepts/configuration/secret/">Secret</a> as env variables source. So all keys of ConfigMap or Secret will be names of environment variables:</p>
<pre class="php"><code>public function env(EnvConfigurator $env): void
{
    $env
        -&gt;addConfigMap(SomeConfigMap::class)
        -&gt;addSecret(SomeSecret::class)
    ;
}
</code></pre>
<p>Or, even simpler:</p>
<pre class="php"><code>public function env(EnvConfigurator $env): void
{
    $env
        -&gt;addFrom(SomeConfigMap::class)
        -&gt;addFromClasses(
            SomeOtherConfigMap::class,
            SomeSecret::class,
            SomeOtherSecret::class
        )
    ;
}
</code></pre>
<h3 id="using-env-configmaps-or-secrets-that-are-in-different-app">Using env ConfigMaps or Secrets that are in different app</h3>
<p>Examples above will work only if  <a href="https://kubernetes.io/docs/concepts/configuration/configmap/">ConfigMaps</a> and <a href="https://kubernetes.io/docs/concepts/configuration/secret/">Secrets</a> you add belong to the same <a href="../apps/">app</a> as your <em>container class</em>.</p>
<p>For example, if you have container class <code>K8S\Hello\Container\NginxContainer</code>, where <code>K8S\Hello</code> is your app namespace, and you are trying to add variables from <code>K8S\World\Manifest\SomeConfigMap</code> as above - it will not work. Using env sources from other apps is considered a bad practice, since it will couple your apps, and it means that your apps are not structured correctly. But if you absolutely have to do this - here is how it's done:</p>
<pre class="php"><code>public function env(EnvConfigurator $env): void
{
    $env
        -&gt;withExternalApp(WorldApp::name())
            -&gt;addFrom(SomeConfigMap::class)
        -&gt;withExternalApp(SomeOtherApp::name())
            -&gt;addFromClasses(YetOneConfigMap::class, YetOneSecret::class)
    ;
}</code></pre>
<p>Method <code>EnvConfigurator::withExternalApp()</code> returns other <code>EnvConfigurator</code> instance, configured to look for env source classes in other app, which name you passed to this method as parameter.</p>
<p>If it's not absolutely clear to you, what does it mean for manifest "to belong to app" - please read <a href="../apps/">Apps</a> article.</p>
<h2 id="volumes-and-volumemounts">Volumes and VolumeMounts</h2>
<p>An issue with <a href="https://kubernetes.io/docs/concepts/storage/volumes/">Volumes</a> and VolumeMounts is that VolumeMounts is a part of container specification, while Volumes are defined on pod spec level, so <code>volumes()</code> method is not a part of <code>ContainerInterface</code>.  This is one more reason to use <code>Container</code>-prefixed <a href="https://kubernetes.io/docs/concepts/workloads/">workloads</a>, such as <code>AbstractContainerDeployment</code>, <code>AbstractContainerCronjob</code> etc. By extending this classes you'll have methods <code>volumes()</code> and <code>volumeMounts()</code> in one class. Here is an example using our <code>WorldDeployment</code> class from <a href="../../getting-started/">Getting Started</a>:</p>
<div class="highlight"><span class="filename">WorldDeployment.php</span><pre><span></span><code><span class="x">class WorldDeployment extends AbstractContainerDeployment</span>
<span class="x">{</span>
<span class="x">    private const VOLUME_TEMP_DIR = &#39;temp-dir&#39;;</span>
<span class="x">    private const VOLUME_PHP_CONF = &#39;php-conf&#39;;</span>

<span class="x">    //...</span>

<span class="x">    public function volumes(VolumesConfigurator $volumes): void</span>
<span class="x">    {</span>
<span class="x">        $volumes</span>
<span class="x">            -&gt;fromEmptyDir(self::VOLUME_TEMP_DIR)</span>
<span class="x">            -&gt;setSizeLimit(Memory::mebibytes(100))</span>
<span class="x">            -&gt;useRAM();</span>

<span class="x">        $volumes-&gt;fromConfigMap(self::VOLUME_PHP_CONF, PhpConfigMap::class);</span>
<span class="x">    }</span>

<span class="x">    public function volumeMounts(VolumeMountsConfigurator $mounts): void</span>
<span class="x">    {</span>
<span class="x">        $mounts-&gt;add(self::VOLUME_TEMP_DIR, &#39;/tmp&#39;);</span>
<span class="x">        $mounts-&gt;add(self::VOLUME_PHP_CONF, &#39;/etc/php/&#39;);</span>
<span class="x">    }</span>

<span class="x">    //...</span>
<span class="x">}</span>
</code></pre></div>
<p>Again, as with env sources, if ConfigMap you want to mount belongs to another app - use <code>withExternalApp()</code> method:</p>
<pre class="php"><code>public function volumes(VolumesConfigurator $volumes): void
{
    $volumes
        -&gt;withExternalApp(SomeOtherApp::name())
        -&gt;fromConfigMap(self::VOLUME_PHP_CONF, PhpConfigMap::class);
}
</code></pre>
<h2 id="summary">Summary</h2>
<p>Please see <code>ContainerInterface</code> in order to see what methods are available for you to define in this class.</p>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../manifests/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Manifests" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Manifests
            </div>
          </div>
        </a>
      
      
        
        <a href="../apps/" class="md-footer__link md-footer__link--next" aria-label="Next: Apps" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Apps
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.6c7ad80a.min.js"></script>
      
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/highlight.min.js"></script>
      
        <script src="../../assets/init.js"></script>
      
    
  </body>
</html>